<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HF-PCAL95555: HF-PCAL95555 Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HF-PCAL95555<span id="projectnumber">&#160;0.1.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">HF-PCAL95555 Driver </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a><b>Hardware Agnostic PCAL95555 library - as used in the HardFOC-V1 controller</b></p>
<p><a href="https://www.gnu.org/licenses/gpl-3.0"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="License: GPL v3" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/N3b3x/hf-pcal95555-driver/actions/workflows/esp32-component-ci.yml"><img src="https://github.com/N3b3x/hf-pcal95555-driver/actions/workflows/esp32-component-ci.yml/badge.svg?branch=main" alt="CI Build" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
ğŸ“š Table of Contents</h1>
<ol type="1">
<li>Overview</li>
<li>Features</li>
<li>Quick Start</li>
<li>Installation</li>
<li>API Reference</li>
<li>Examples</li>
<li>Documentation</li>
<li>Contributing</li>
<li>License</li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
ğŸ“¦ Overview</h1>
<blockquote class="doxtable">
<p>&zwj;<b>ğŸ“– <a href="https://n3b3x.github.io/hf-pcal95555-driver/">ğŸ“šğŸŒ Live Complete Documentation</a></b> - Interactive guides, examples, and step-by-step tutorials </p>
</blockquote>
<p><b>PACL95555</b> is a fully-featured, platform-independent C++ driver for the <b>PCAL9555A</b> GPIO expander by NXP Semiconductors. The PCAL9555A provides 16 general-purpose I/O pins (two 8-bit ports) accessible over IÂ²C and supports advanced "Agile I/O" capabilities including interrupts, drive strength control, polarity inversion, input latching, and internal pull-up/pull-down resistors.</p>
<p>This library abstracts all of that into a clear and extensible C++ API, ready to be used across a wide range of embedded platforms such as STM32, ESP32 (ESP-IDF), Arduino, and more.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
ğŸ“‚ Project Structure</h1>
<div class="fragment"><div class="line">â”œâ”€â”€ datasheet/             # PCAL9555A datasheet PDF</div>
<div class="line">â”œâ”€â”€ examples/              # Sample usage and wiring examples</div>
<div class="line">â”œâ”€â”€ inc/                   # Header files</div>
<div class="line">â”‚   â””â”€â”€ pcal95555.hpp      # Driver header</div>
<div class="line">â”œâ”€â”€ src/                   # Source files</div>
<div class="line">â”‚   â”œâ”€â”€ pcal95555.cpp      # Driver implementation</div>
<div class="line">â”‚   â””â”€â”€ pcal95555_test.cpp # Mock-based unit tests</div>
<div class="line">â”œâ”€â”€ LICENSE                # GNU GPLv3 license</div>
<div class="line">â””â”€â”€ README.md              # Project documentation</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
ğŸš€ Quick Start</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;pcal95555.hpp&quot;</span></div>
<div class="line">MyPlatformI2CBus i2c;               <span class="comment">// Custom i2cBus implementation</span></div>
<div class="line">PACL95555 gpio(&amp;i2c, 0x20);        <span class="comment">// 0x20 is default I2C address</span></div>
<div class="line"> </div>
<div class="line">gpio.ResetToDefault();             <span class="comment">// Safe known state (inputs w/ pull-ups)</span></div>
<div class="line"><span class="comment">// Optionally configure using values from Kconfig</span></div>
<div class="line">gpio.InitFromConfig();</div>
<div class="line"> </div>
<div class="line">gpio.SetPinDirection(0, GPIODir::Output);</div>
<div class="line">gpio.WritePin(0, <span class="keyword">true</span>);</div>
<div class="line"><span class="keywordtype">bool</span> isHigh = gpio.ReadPin(1);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
ğŸ”Œ Platform Integration</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
âœ… ESP32 (ESP-IDF)</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>ESP32I2CBus : <span class="keyword">public</span> pcal95555::I2cInterface&lt;ESP32I2CBus&gt; {</div>
<div class="line">    <span class="keywordtype">bool</span> write(uint8_t addr, uint8_t reg, <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> len)<span class="keyword"> override </span>{</div>
<div class="line">        uint8_t buf[1 + len];</div>
<div class="line">        buf[0] = reg;</div>
<div class="line">        memcpy(&amp;buf[1], data, len);</div>
<div class="line">        <span class="keywordflow">return</span> i2c_master_write_to_device(I2C_NUM_0, addr, buf, len+1, 100 / portTICK_PERIOD_MS) == ESP_OK;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> read(uint8_t addr, uint8_t reg, uint8_t *data, <span class="keywordtype">size_t</span> len)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> i2c_master_write_read_device(I2C_NUM_0, addr, &amp;reg, 1, data, len, 100 / portTICK_PERIOD_MS) == ESP_OK;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
âœ… STM32 (HAL)</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>STM32I2CBus : <span class="keyword">public</span> pcal95555::I2cInterface&lt;STM32I2CBus&gt; {</div>
<div class="line">    <span class="keywordtype">bool</span> write(uint8_t addr, uint8_t reg, <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> len)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> HAL_I2C_Mem_Write(&amp;hi2c1, addr&lt;&lt;1, reg, 1, (uint8_t*)data, len, HAL_MAX_DELAY) == HAL_OK;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> read(uint8_t addr, uint8_t reg, uint8_t *data, <span class="keywordtype">size_t</span> len)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> HAL_I2C_Mem_Read(&amp;hi2c1, addr&lt;&lt;1, reg, 1, data, len, HAL_MAX_DELAY) == HAL_OK;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
âœ… Arduino (Wire)</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>ArduinoI2CBus : <span class="keyword">public</span> pcal95555::I2cInterface&lt;ArduinoI2CBus&gt; {</div>
<div class="line">    <span class="keywordtype">bool</span> write(uint8_t addr, uint8_t reg, <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> len)<span class="keyword"> override </span>{</div>
<div class="line">        Wire.beginTransmission(addr);</div>
<div class="line">        Wire.write(reg);</div>
<div class="line">        Wire.write(data, len);</div>
<div class="line">        <span class="keywordflow">return</span> Wire.endTransmission() == 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> read(uint8_t addr, uint8_t reg, uint8_t *data, <span class="keywordtype">size_t</span> len)<span class="keyword"> override </span>{</div>
<div class="line">        Wire.beginTransmission(addr);</div>
<div class="line">        Wire.write(reg);</div>
<div class="line">        <span class="keywordflow">if</span> (Wire.endTransmission(<span class="keyword">false</span>) != 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        Wire.requestFrom(addr, len);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; len; ++i) data[i] = Wire.read();</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
ğŸ§ª Unit Testing</h1>
<p>To run the built-in unit tests on a desktop:</p>
<div class="fragment"><div class="line"># Windows PowerShell</div>
<div class="line">g++ -std=c++11 pcal95555.cpp pcal95555_test.cpp -o test.exe</div>
<div class="line">./test.exe</div>
</div><!-- fragment --><p>These tests use a mock I2C class to validate:</p>
<ul>
<li>Register correctness</li>
<li>Retry logic</li>
<li>Polarity inversion</li>
<li>Interrupt latching</li>
<li>Pull resistor settings</li>
<li>Output state reflection</li>
</ul>
<p>Expected output:</p>
<div class="fragment"><div class="line">All tests passed.</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
